# nmap 扫描

## 命令

### 一（两）句话扫描

```bash
ports=$(nmap -Pn -p- --min-rate=1000 -T4 $IP | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//)
nmap -p$ports -Pn -sC -sV $IP
```

### 扫描网段

`sudo nmap -sn 172.16.200.0/24`

### 扫描操作系统

`sudo nmap -O ...`

### 扫描端口

`sudo nmap --min-rate 10000 -p- 172.16.200.131 -oA ports`

- 最低速率`10000`是权衡的结果，过快扫不准，过慢时间长，10000 是一般情况下适合的值
- 10000 是指每秒钟发送 10000 个数据包，即每秒钟扫描 10000 个端口
- `-p-`表示 1-65535 端口

### 扫描 UDP 端口

`sudo nmap -sU --min-rate 10000 -p- 172.16.200.131 -oA UDPports`

- `-sU` 使用 UDP

### 格式化端口信息

`grep open ports.nmap | awk -F'/' '{print $1}' | tr '\n' ','`

### 扫描服务

`sudo nmap -sT -sV -sC -O -pxx,xx,xx 172.16.200.131`

- `-sT` 使用 TCP
- `-sV` 扫描服务版本
- `-sC` 使用默认脚本
- `-O` 扫描操作系统信息
- `xx` 表示扫描出来的端口

### 扫描漏洞

`sudo nmap --script=vuln -pxx,xx,xx 172.16.200.131`

## Linux Shell 脚本 ping 扫描

`for i in {1..254};do ping -c 1 -W 1 172.16.200.$i | grep from;done`
ping 成功后会显示 from，所以使用 grep from；-c：发包数量；-W：超时时间

## Linux 伪设备扫描端口

`for i in {1..65535};do (echo < /dev/tcp/172.16.200.131/$i) &>/dev/null && printf "[+] The Open Port is: %d\n" "$i";done`

- `&>/dev/null` 把标准输出和标准错误输出都重定向到/dev/null，即不显示任何信息
- `&&` 表示前面的命令执行成功后才执行后面的命令，即端口连接成功时才显示端口号

## netcat 实现端口扫描

新版 kali 中装的是新版的 nc，要实现端口扫描，需要使用旧版 nc，命令为 nc.traditional
`nc.traditional -vv -z 172.16.200.131 1-65535 2>&1 | grep -v refused`

- `-vv` 选项表示 "very verbose"，即非常详细的输出模式。使用该选项会生成更详细的连接信息，包括连接的建立和关闭过程中的各种状态。
- `-z` 选项用于进行端口扫描而不建立实际的连接。它会尝试连接指定的 IP 地址和端口，但不会发送实际的数据。
- `2>&1` 是一种重定向语法，用于将标准错误输出（stderr）重定向到标准输出（stdout）；
- grep 的`-v`表示反向

## Windows 批处理脚本扫描主机

`for /l %i in (1,1,254) do ping -n 1 -w 1 172.16.200.%i | find "TTL="`

## 扫描某台主机的 IPv6 地址/其他地址

[IOXIDResolver](https://github.com/mubix/IOXIDResolver)
`sudo python3 ./IOXIDResolver.py -t xxx.xxx.xxx.xxx`
namp 扫描 IPv6 地址：-6

## snmpwalk 扫描

snmp 是一种网络管理协议，可以通过 snmpwalk 扫描主机信息
`sudo snmpwalk -c public -v2c`

- `-c` 指定 community
- `-v2c` 指定版本，有 v1、v2c、v3
