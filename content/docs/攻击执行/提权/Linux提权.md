# Linux提权

<https://book.hacktricks.xyz/linux-hardening/privilege-escalation>

## 自动化工具

### Traitor

> Automatically exploit low-hanging fruit to pop a root shell. Linux privilege escalation made easy!
>
> - Linux 自动化提权二进制文件
> - 交互式
>   <https://github.com/liamg/traitor>

### PEASS-ng

> Privilege Escalation Awesome Scripts SUITE new generation
>
> - `linPEAS` and `winPEAS` are powerful scripts that search for possible paths to escalate privileges on Windows and Linux/Unix* hosts.
> - Linux&Windows 提权漏洞探测脚本
>   <https://github.com/carlospolop/PEASS-ng>

## sudo su

如果当前用户有sudo权限，可以使用`sudo su`提权

## SUID 提权

<https://securiumsolutions.com/privilege-escalation-with-suid-in-linux/>

SUID 提权是一种利用 Linux 系统中具有 SUID 权限的文件来获取 root 权限的技术。SUID（Set User ID）是一种特殊的文件权限，它可以让用户以文件所有者的身份运行该文件。如果该文件的所有者是 root 用户，那么运行该文件的用户就可以暂时获得 root 权限，从而执行一些需要高权限的操作。

如果设置了 GUID 位，那么运行该文件的用户就可以暂时获得文件所属组的权限。

SUID 提权的前提条件是：

- 文件的所有者是 root 用户或其他超级用户
- 文件具有 SUID 权限（即文件权限中有 s 位）
- 文件是二进制可执行文件，且能够执行命令操作

```bash
chmod u+s filename   #设置 SUID 位
chmod u-s filename   #去掉 SUID 设置

find / -perm -u=s -type f 2>/dev/null
# 在 Linux 系统中用于查找具有"SetUID"权限位设置的可执行文件的命令
# -perm 表示按照文件权限来搜索
# -u=s 表示查找具有"SetUID"权限位的文件
# -type f: 这个选项告诉 find 命令只查找普通文件，而不是目录或其他类型的文件。
# 2>/dev/null: 这是一个重定向操作，将标准错误输出（stderr）重定向到/dev/null，这样可以将任何错误消息静默化，以便只输出符合条件的文件列表。

# SUID
find / -perm -4000 -type f -ls 2>/dev/null

# GUID
find / -perm -2000 -type f -ls 2>/dev/null
```

### 已知可用来提权的 linux 文件

- nmap
- vim
- find
- bash
- more
- less
- nano
- cp
- awk
- ...

## 内核漏洞提权

## SUDO提权

### CVE-2019-14287

sudo版本小于1.8.28

sudo切换用户：`sudo -u jack /bin/bash`或`sudo -u#1000 /bin/bash`

exp：`sudo -u#-1 /bin/bash`

-1被sudo解释成0

### sudo -l

```bash
sudo -l
```

<https://gtfobins.github.io/>

## 计划任务提权

```bash
cat /etc/crontab
```

[定时任务](../../信息收集/定时任务.md)

查看文件权限

```bash
ls -l /etc/cron*
```

## NFS 提权

## Capabilities 位提权

<https://www.cnblogs.com/sparkdev/p/11417781.html>

探查有 CAP_SETUID 标志的进程
`/sbin/getgap -r / 2>/dev/null`

| capability 名称 | 描述 |
| --- | --- |
| CAP_AUDIT_CONTROL | 启用和禁用内核审计；改变审计过滤规则；检索审计状态和过滤规则 |
| CAP_AUDIT_READ | 允许通过 multicast netlink 套接字读取审计日志 |
| CAP_AUDIT_WRITE | 将记录写入内核审计日志 |
| CAP_BLOCK_SUSPEND | 使用可以阻止系统挂起的特性 |
| CAP_CHOWN | 修改文件所有者的权限 |
| CAP_DAC_OVERRIDE | 忽略文件的 DAC 访问限制 |
| CAP_DAC_READ_SEARCH | 忽略文件读及目录搜索的 DAC 访问限制 |
| CAP_FOWNER | 忽略文件属主 ID 必须和进程用户 ID 相匹配的限制 |
| CAP_FSETID | 允许设置文件的 setuid 位 |
| CAP_IPC_LOCK | 允许锁定共享内存片段 |
| CAP_IPC_OWNER | 忽略 IPC 所有权检查 |
| CAP_KILL | 允许对不属于自己的进程发送信号 |
| CAP_LEASE | 允许修改文件锁的 FL_LEASE 标志 |
| CAP_LINUX_IMMUTABLE | 允许修改文件的 IMMUTABLE 和 APPEND 属性标志 |
| CAP_MAC_ADMIN | 允许 MAC 配置或状态更改 |
| CAP_MAC_OVERRIDE | 覆盖 MAC(Mandatory Access Control) |
| CAP_MKNOD | 允许使用 mknod() 系统调用 |
| CAP_NET_ADMIN | 允许执行网络管理任务 |
| CAP_NET_BIND_SERVICE | 允许绑定到小于 1024 的端口 |
| CAP_NET_BROADCAST | 允许网络广播和多播访问 |
| CAP_NET_RAW | 允许使用原始套接字 |
| CAP_SETGID | 允许改变进程的 GID |
| CAP_SETFCAP | 允许为文件设置任意的 capabilities |
| CAP_SETPCAP | 参考 capabilities man page |
| CAP_SETUID | 允许改变进程的 UID |
| CAP_SYS_ADMIN | 允许执行系统管理任务，如加载或卸载文件系统、设置磁盘配额等 |
| CAP_SYS_BOOT | 允许重新启动系统 |
| CAP_SYS_CHROOT | 允许使用 chroot() 系统调用 |
| CAP_SYS_MODULE | 允许插入和删除内核模块 |
| CAP_SYS_NICE | 允许提升优先级及设置其他进程的优先级 |
| CAP_SYS_PACCT | 允许执行进程的 BSD 式审计 |
| CAP_SYS_PTRACE | 允许跟踪任何进程 |
| CAP_SYS_RAWIO | 允许直接访问 /devport、/dev/mem、/dev/kmem 及原始块设备 |
| CAP_SYS_RESOURCE | 忽略资源限制 |
| CAP_SYS_TIME | 允许改变系统时钟 |
| CAP_SYS_TTY_CONFIG | 允许配置 TTY 设备 |
| CAP_SYSLOG | 允许使用 syslog() 系统调用 |
| CAP_WAKE_ALARM | 允许触发一些能唤醒系统的东西（比如 CLOCK_BOOTTIME_ALARM 计时器） |
