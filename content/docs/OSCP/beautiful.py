import csv
from bs4 import BeautifulSoup

# 解析HTML文件
def parse_html(html_content):
    soup = BeautifulSoup(html_content, 'html.parser')
    posts = soup.find_all('li', class_='post-list-li')
    
    # 创建一个字典，存储每个标题及其对应的tags
    post_tags = {}
    for post in posts:
        title = post.find('h3', class_='post-list-h3').get_text(strip=True)
        tag_list = post.find('span', class_='tag-list')
        tags = ' '.join(tag.get_text(strip=True) for tag in tag_list.find_all('a'))
        post_tags[title] = tags
    
    return post_tags

# 读取CSV并匹配HTML中的数据
def process_csv_and_html(csv_path, html_content, output_csv_path):
    post_tags = parse_html(html_content)
    
    with open(csv_path, mode='r', newline='', encoding='utf-8') as infile, \
         open(output_csv_path, mode='w', newline='', encoding='utf-8') as outfile:
        
        reader = csv.reader(infile)
        writer = csv.writer(outfile)
        
        for row in reader:
            post_title = f"HTB: {row[0]}"  # 拼接"HTB: xxx"
            tags = post_tags.get(post_title, "")  # 获取对应的tags
            writer.writerow([post_title, tags])  # 写入新的CSV文件

# 使用示例
html_file_path = 'index.html'
csv_file_path = 'input.csv'
output_csv_file_path = 'output.csv'

# 读取HTML文件
with open(html_file_path, 'r', encoding='utf-8') as file:
    html_content = file.read()

# 处理CSV和HTML并生成新CSV文件
process_csv_and_html(csv_file_path, html_content, output_csv_file_path)
