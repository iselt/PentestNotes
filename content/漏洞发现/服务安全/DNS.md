# DNS

<https://book.hacktricks.xyz/network-services-pentesting/pentesting-dns>

## Any record

记录 **ANY** 将要求 DNS 服务器返回其愿意披露的所有可用条目。

```bash
dig any example.com @<DNS_SERVER>
```

## More info

```bash
dig ANY @<DNS_SERVER> <DOMAIN>     #Any information
dig A @<DNS_SERVER> <DOMAIN>       #常规 DNS 请求
dig AAAA @<DNS_SERVER> <DOMAIN>    #IPv6 DNS 请求
dig TXT @<DNS_SERVER> <DOMAIN>     #文本记录
dig MX @<DNS_SERVER> <DOMAIN>      #邮件交换记录
dig NS @<DNS_SERVER> <DOMAIN>      #域名服务器记录（DNS that resolves that name）
```

## 反向查询

```bash
dig -x 192.168.0.2 @<DNS_SERVER>   #反向查询
dig -x 2a00:1450:400c:c06::93 @<DNS_SERVER> #反向 IPv6 查询
```

```bash
nslookup
> server <DNS_SERVER>
> <MACHINE_IP>
```

## 自动化枚举

```bash
for sub in $(cat <WORDLIST>);do dig $sub.<DOMAIN> @<DNS_IP> | grep -v ';\|SOA' | sed -r '/^\s*$/d' | grep $sub | tee -a subdomains.txt;done
```

```bash
dnsenum --dnsserver <DNS_IP> --enum -p 0 -s 0 -o subdomains.txt -f <WORDLIST> <DOMAIN>
```

```bash
dnsenum --dnsserver <IP_DNS> --enum -p 0 -s 0 -o subdomains.txt -f subdomains-1000.txt <DOMAIN>
dnsrecon -D subdomains-1000.txt -d <DOMAIN> -n <IP_DNS>
dnscan -d <domain> -r -w subdomains-1000.txt #Bruteforce subdomains in recursive way, https://github.com/rbsec/dnscan
```

```bash
dnsrecon -r 127.0.0.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r 127.0.1.0/24 -n <IP_DNS>  #DNS reverse of all of the addresses
dnsrecon -r <IP_DNS>/24 -n <IP_DNS>   #DNS reverse of all of the addresses
dnsrecon -d active.htb -a -n <IP_DNS> #Zone transfer
```

## 域传输泄露漏洞（AXFR）

Asynchronous Full Transfer Zone

### 漏洞原理

DNS服务器在进行域传输时，会将整个域的信息全部传输给请求者，如果攻击者获取到了这个传输的权限，就可以获取到整个域的信息。

### 漏洞利用

#### nslookup (Only Windows)

```bash
nslookup
> server <DNS_SERVER>
> ls -d example.com
```

#### dig

```bash
dig axfr example.com @<DNS_SERVER>
```
