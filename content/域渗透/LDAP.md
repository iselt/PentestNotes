+++
title = "LDAP 渗透测试"
+++

<https://book.hacktricks.xyz/network-services-pentesting/pentesting-ldap>

## 端口

389、636、3268、3269

## windapsearch

windapsearch 是一款通过 LDAP 查询协助 Active Directory 域枚举的工具。 它包含多个模块，用于枚举用户、组、计算机，以及执行搜索和未授权信息收集。

## 匿名访问

### 尝试获取 LDAP 命名上下文

```bash
ldapsearch -H ldap://<IP> -x -s base namingcontexts
```

### big dump (需要命名上下文，可能需要身份验证)

```bash
ldapsearch -H ldap://<IP> -x -b "<Naming_Context>"
```

> 注：Naming_Context 格式为 `dc=example,dc=com`

### nmap枚举

```bash
nmap -n -sV --script "ldap* and not brute" <IP> #Using anonymous credentials
```

### 用户枚举

#### RID 循环攻击

<https://0xdf.gitlab.io/2024/03/16/htb-manager.html#smb---tcp-445>

```shell
impacket-lookupsid somebody@manager.htb -no-pass
```

#### kerbrute

```bash
kerbrute userenum /opt/SecLists/Usernames/cirt-default-usernames.txt --dc dc01.manager.htb -d manager.htb
```

## 爆破

```bash
nmap --script ldap-brute -p 389 <IP>
```

```bash
legba ldap --target 127.0.0.1:389 --username admin --password @wordlists/passwords.txt --ldap-domain example.org --single-match
```

```bash
hydra -l <username> -P <password> <IP> ldap2
```
